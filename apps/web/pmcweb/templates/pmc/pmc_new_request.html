{% load static %}
<!doctype html>
<html id="printArea" lang="en">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
	<meta http-equiv="X-UA-Compatible" content="ie=edge"/>
	<title>GOC Automation Platform</title>
	<!-- CSS files -->
    <link href="{% static 'plugin/layui/css/layui.css' %}" rel="stylesheet"/>
	<link href="{% static 'plugin/tabler/css/tabler-vendors.min.css' %}" rel="stylesheet"/>
	<link href="{% static 'plugin/tabler/css/tabler.min.css' %}" rel="stylesheet"/>
	<style>
      @import url('{% static 'plugin/tabler/css/inter.css' %}');
      :root {
          --tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
          font-feature-settings: "cv03", "cv04", "cv11";
      }
	</style>
</head>
<body>
  <div class="page">
	<div class="page-wrapper">
		<!-- Page header -->
		<div class="page-header d-print-none">
			<div class="container-xl">
				<div class="row g-2 align-items-center">
					<div class="col">
						<!-- Page pre-title -->
						<div class="page-pretitle">
							PMC Tools
						</div>
						<h2 class="page-title">
                            <a href="#" onclick="pmcViewRequestIndexRedirect()">New Request</a>
						</h2>
					</div>
				</div>
			</div>
		</div>
		<!-- Page Body -->

		<div class="page-body">
			<div class="container-xl">
				<div class="row row-cards">
                    <div class="col-md-12">
                        <div id="saveLoadingDiv" class="card">
                            <div id="printTittle" class="card-header">
                              <h3 class="card-title">Create new PMC request / activity plan</h3>
                            </div>
                            <div class="card-body">
                                <!-- New PMC Request Form -->
                                <form id="newRequestForm">
                                    {% csrf_token %}
                                    <div class="row row-cards">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <div id="itspNumberDiv" class="input-icon">
                                                    <div class="input-group input-group-flat">
                                                        <input id="itspNumber" name="itspNumber" type="text" class="form-control searchArea" placeholder="ITSP Number">
                                                        <span class="input-group-text">
                                                        <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                        </a>
                                                        </span>
                                                    </div>
                                                    <div class="invalid-feedback">ITSP number is not valid!</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <button id="retrieveITSPDataBtn" type="button" class="btn btn-primary">
                                                    Retrieve data
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-6"></div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label required">PMC Status</label>
                                                <select id="pmcStatus" name="pmcStatus" class="form-select">
                                                    <option value="0">New</option>
                                                    <option value="1">In Progress</option>
                                                    <option value="2">Pending</option>
                                                    <option value="3">Scheduled</option>
                                                    <option value="4">Completed</option>
                                                    <option value="5">Cancelled</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label required" onclick="copyText(this)">Change Number</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="changeNumber" name="changeNumber" type="text" class="form-control searchArea" value="Not created" placeholder="Change Number">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Change number is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Change Class</label>
                                                <select id="changeClass" name="changeClass" class="form-control form-select">
                                                    <option value="0">0</option>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">EM</option>
                                                    <option value="4">-</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Start With Shutdown</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="startWithShutdown" name="startWithShutdown" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Start With Shutdown code is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label" onclick="copyText(this)">Start Time (Power Cut Time) </label>
                                                <div class="input-icon">
                                                      <span class="input-icon-addon"><!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                                             stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path
                                                                d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path
                                                                d="M16 3l0 4"></path><path d="M8 3l0 4"></path><path d="M4 11l16 0"></path><path
                                                                d="M11 15l1 0"></path><path d="M12 15l0 3"></path></svg>
                                                      </span>
                                                      <input id="pmcStartTime" name="pmcStartTime" class="form-control" placeholder="Select a date">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label" onclick="copyText(this)">End Time (Power Back Time)</label>
                                                <div class="input-icon">
                                                  <span class="input-icon-addon"><!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                                         viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                                         stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path
                                                            d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path><path
                                                            d="M16 3l0 4"></path><path d="M8 3l0 4"></path><path d="M4 11l16 0"></path><path
                                                            d="M11 15l1 0"></path><path d="M12 15l0 3"></path></svg>
                                                  </span>
                                                  <input id="pmcEndTime" name="pmcEndTime" class="form-control" placeholder="Select a date">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Region</label>
                                                <select id="region" name="region" class="form-select">
                                                    <option value="EMEA">EMEA</option>
                                                    <option value="AP">AP</option>
                                                    <option value="AM">AM</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Location Code</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="locationCode" name="locationCode" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Location Code is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">People Onsite</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="peopleOnSite" name="peopleOnSite" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">People Onsite is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Engineer Address</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="emailAddress" name="emailAddress" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Engineer Email address is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 printHiddenArea">
                                            <div class="mb-3">
                                                <label class="form-label">Contact Information</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="contactInformation" name="contactInformation" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Contact Information is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 printHiddenArea">
                                            <div class="mb-3">
                                                <label class="form-label">Addition People</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="additionalPeople" name="additionalPeople" type="text" class="form-control searchArea">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">Addition People Information is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 printHiddenArea">
                                            <div class="mb-3">
                                                <label class="form-label required">Power Off Assignee</label>
                                                <select id="powerOffAssignee" name="powerOffAssignee" type="text" class="form-select">
                                                  <option value="">Not assigned</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4 printHiddenArea">
                                            <div class="mb-3">
                                                <label class="form-label required">Power On Assignee</label>
                                                <select id="powerOnAssignee" name="powerOnAssignee" type="text" class="form-select">
                                                  <option value="">Not assigned</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label" onclick="copyText(this)">DCR</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="dataCenterRoom" name="dataCenterRoom" type="text" class="form-control" placeholder="Data Center Room">
                                                  <span class="input-group-text">
                                                    <a href="#" class="link-secondary clearSearch" data-bs-toggle="tooltip"><!-- Download SVG icon from http://tabler-icons.io/i/x -->
                                                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                                                    </a>
                                                  </span>
                                                </div>
                                                <div class="invalid-feedback">DCR code is not valid!</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label required">PMC Coordinator</label>
                                                <select id="pmcCoordinator" name="pmcCoordinator" type="text" class="form-select">
                                                  <option value="">Not assigned</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">SAN</label>
                                                <select id="sanSelection" name="sanSelection" class="form-select" multiple>
                                                    <option value="TOBECHECKED" selected>-</option>
                                                    <option value="NO">NO</option>
                                                    <option value="VNX">VNX</option>
                                                    <option value="UNITY">UNITY</option>
                                                    <option value="VPLEX">VPLEX</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">NAS</label>
                                                <select id="nasSelection" name="nasSelection" class="form-control form-select">
                                                    <option value="2">-</option>
                                                    <option value="1">YES</option>
                                                    <option value="0">NO</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">Backup</label>
                                                <select id="backupSelection" name="backupSelection" class="form-control form-select" onchange="backupSelectionOnchange(this)">
                                                    <option value="2">-</option>
                                                    <option value="1">Yes</option>
                                                    <option value="0">NO</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Backup Assignee</label>
                                                <select id="backupAssignee" name="backupAssignee" type="text" class="form-select" disabled>
                                                  <option value="">Not assigned</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">Oracle DB</label>
                                                <select id="oracleDBSelection" name="oracleDBSelection" class="form-control form-select" onchange="oracleDBSelectionOnchange(this)">
                                                    <option value="2">-</option>
                                                    <option value="1">YES</option>
                                                    <option value="0">NO</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Oracle DB Assignee</label>
                                                <select id="oracleDBAssignee" name="oracleDBAssignee" type="text" class="form-select" disabled>
                                                  <option value="">Not assigned</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="mb-3">
                                                <label class="form-label">High Availbility</label>
                                                <select id="highAvailbilitySelection" name="highAvailbilitySelection" class="form-control form-select" onchange="highAvailbilitySelectionOnchange(this)">
                                                    <option value="2">-</option>
                                                    <option value="1">YES</option>
                                                    <option value="0">NO</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label" onclick="copyText(this)">HA Server Room</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="serverRoomToFailover" name="serverRoomToFailover" type="text" class="form-control" placeholder="Server room to failover" disabled>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" onclick="copyText(this)">HA Service</label>
                                                <div class="input-group input-group-flat">
                                                  <input id="serviceToFailover" name="serviceToFailover" type="text" class="form-control" placeholder="Service to failover" disabled>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label">Reason</label>
                                            <textarea id="reason" name="reason" rows="5" class="form-control" placeholder="Reason" style="resize: none"></textarea>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!-- Card footer -->
                            <div class="card-footer text-end">
                                <button id="activityPlanSave" type="button" class="btn btn-primary ms-auto">
                                  <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                  Create new activity
                                </button>
                            </div>
                        </div>

                        <hr>
                    </div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
<!-- Load JS -->
<script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'plugin/layui/layui.js' %}"></script>
<script src="{% static 'plugin/tabler/libs/tom-select/dist/js/tom-select.base.min.js' %}"></script>
<script src="{% static 'plugin/tabler/js/tabler.min.js' %}"></script>
<!-- Auto adjust iFrame height -->
<script type="text/javascript">
    // Initiate function
    $(function () {
        // iFrame height refresh
        refreshHeight();
        // Date time initiation
        datetimeInitiate();
        // Power on/off selector initiation
        pmcAssigneeInitiate();
        // PMC Coordinator selector initiation
        pmcCoordinatorInitiate();
        // Retrieve PMC data from ITSP
        retrieveITSPData();
        // Save PMC activity
        savePMCActivity();
        // Clear input text initiation
        clearSearch();
    });

    // iFrame height initiation
    function refreshHeight() {
        top.postMessage(document.body.scrollHeight, '*');
    }


    var select_backup;
    var select_oracledb;
    // Control div when backup type change
    function backupSelectionOnchange(obj) {
        let select_value = obj.options[obj.selectedIndex].value;
        if (select_value == '1') {
            select_backup.enable();
        } else {
            select_backup.setValue('');
            select_backup.disable();
        }
    }

    // Control div when oracle DB selection change
    function oracleDBSelectionOnchange(obj) {
        let select_value = obj.options[obj.selectedIndex].value;
        if (select_value == '1') {
            select_oracledb.enable();
        } else {
            select_oracledb.setValue('');
            select_oracledb.disable();
        }
        
    }

    // Control div when high availbility selection change
    function highAvailbilitySelectionOnchange(obj) {
        let select_value = obj.options[obj.selectedIndex].value;
        if (select_value == '1') {
            $('#serverRoomToFailover').removeAttr('disabled');
            $('#serviceToFailover').removeAttr('disabled');
        } else {
            $('#serverRoomToFailover').val('');
            $('#serviceToFailover').val('');
            $('#serverRoomToFailover').attr('disabled', 'disabled');
            $('#serviceToFailover').attr('disabled', 'disabled');
        }
    }

    // Initiate datetime plugin
    function datetimeInitiate() {
        layui.use(['laydate'], function () {
            let laydate = layui.laydate;

            // Maintenance date time
            laydate.render({
                elem: '#pmcStartTime',
                type: 'datetime',
                lang: 'en'
            });
            laydate.render({
                elem: '#pmcEndTime',
                type: 'datetime',
                lang: 'en'
            });
        })
    }

    // Clear button initiation
    function clearSearch(){
        $('.clearSearch').on('click', function (){
            let inputItsp = $(this).parents()[0]
            $(inputItsp).prev().val('').focus();
        });
    }

    // Text copy function
    function copyText(ele){
        let copyipt = document.createElement("input");
        let copyContent;
        if ($(ele).html().indexOf('Time') !== -1) {
            copyContent = $(ele).next().children(':last-child').val();
        } else {
            copyContent = $(ele).next().children(':first-child').val();
        }

        copyipt.setAttribute("value", copyContent);
        document.body.appendChild(copyipt);
        copyipt.select();
        document.execCommand("copy");
        document.body.removeChild(copyipt);
        layer.msg($(ele).text() + ' copied.', { offset: ['20%', '45%'] });
    }

    // Load PMC assignee data
    function pmcAssigneeInitiate(){
        // Get assignee information by ajax
        $.ajax({
            url: "{% url 'new_request_get_assignee' %}",
            method: 'POST',
            data: $('#newRequestForm').serialize(),
            dataType: 'json',
            success: function (res) {
                if (res.status) {
                    // Add search results
                    if (res.data.length > 0) {
                        // Append options for assignee selector
                        $.each(res.data, (index, assignee) => {
                            if (assignee.responsible == 'Server;Storage') {
                                $('#powerOffAssignee').append(`<option value="${assignee.name}"> ${assignee.name} </option>`);
                                $('#powerOnAssignee').append(`<option value="${assignee.name}"> ${assignee.name} </option>`);
                            } else if (assignee.responsible == 'Backup') {
                                $('#backupAssignee').append(`<option value="${assignee.name}"> ${assignee.name} </option>`);
                            } else if (assignee.responsible == 'OracleDB') {
                                $('#oracleDBAssignee').append(`<option value="${assignee.name}"> ${assignee.name} </option>`);
                            } else {
                                console.log('No reponsibility assigned:' + assignee.name)
                            }
                        });
                        formSelectInitiate();
                    }
                } else {
                    layer.msg('Error retrieving assignee list:' + res.error)
                }
            }
        });
    }

    // Load PMC coordinator data
    function pmcCoordinatorInitiate(){
        // Get coordinator list
        $.ajax({
            url: "{% url 'new_request_get_pmc_coordinator' %}",
            method: 'POST',
            data: $('#newRequestForm').serialize(),
            dataType: 'json',
            success: function (res) {
                if (res.status) {
                    // Add search results
                    if (res.data.length > 0) {
                        // Append options for assignee selector
                        $.each(res.data, (index, assignee) => {
                            $('#pmcCoordinator').append(`<option value="${assignee}"> ${assignee} </option>`);
                        });
                        
                        let el;
                        window.TomSelect && (new TomSelect(el = $('#pmcCoordinator'), {
                            copyClassesToDropdown: false,
                            dropdownParent: 'body',
                            controlInput: '<input>',
                            render:{
                                item: function(data,escape) {
                                    if( data.customProperties ){
                                        return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
                                    }
                                    return '<div>' + escape(data.text) + '</div>';
                                },
                                option: function(data,escape){
                                    if( data.customProperties ){
                                        return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
                                    }
                                    return '<div>' + escape(data.text) + '</div>';
                                },
                            },
                        }));
                    }
                } else {
                    layer.msg('Error retrieving coordinator list.')
                }
            }
        });
    }

    // Selector initiation
    function formSelectInitiate(){
        let el;
    	window.TomSelect && (new TomSelect(el = $('#powerOffAssignee'), {
    		copyClassesToDropdown: false,
    		dropdownParent: 'body',
    		controlInput: '<input>',
    		render:{
    			item: function(data,escape) {
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    			option: function(data,escape){
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    		},
    	}));

        window.TomSelect && (new TomSelect(el = $('#powerOnAssignee'), {
    		copyClassesToDropdown: false,
    		dropdownParent: 'body',
    		controlInput: '<input>',
    		render:{
    			item: function(data,escape) {
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    			option: function(data,escape){
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    		},
    	}));

        window.TomSelect && (new TomSelect(el = $('#sanSelection'), {
    		copyClassesToDropdown: false,
    		dropdownParent: 'body',
    		controlInput: '<input>',
    		render:{
    			item: function(data,escape) {
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    			option: function(data,escape){
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    		},
    	}));

        select_backup = new TomSelect(el = $('#backupAssignee'), {
    		copyClassesToDropdown: false,
    		dropdownParent: 'body',
    		controlInput: '<input>',
    		render:{
    			item: function(data,escape) {
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    			option: function(data,escape){
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    		},
    	});

        select_oracledb = new TomSelect(el = $('#oracleDBAssignee'), {
    		copyClassesToDropdown: false,
    		dropdownParent: 'body',
    		controlInput: '<input>',
    		render:{
    			item: function(data,escape) {
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    			option: function(data,escape){
    				if( data.customProperties ){
    					return '<div><span class="dropdown-item-indicator">' + data.customProperties + '</span>' + escape(data.text) + '</div>';
    				}
    				return '<div>' + escape(data.text) + '</div>';
    			},
    		},
    	});
    }

    // Retrieve ITSP data from API
    function retrieveITSPData(){
        $('#retrieveITSPDataBtn').on('click', function (){

            if (itspRequestInputValidate()) {
                // Add disabled class to button
                $('#retrieveITSPDataBtn').addClass('btn-loading');
                // Get assignee information by ajax
                $.ajax({
                    url: "{% url 'new_request_get_itsp_data' %}",
                    method: 'POST',
                    data: $('#newRequestForm').serialize(),
                    dataType: 'json',
                    success: function (res) {
                        if (res.status) {
                            insertValueToForm(res.data);
                        } else {
                            layer.msg('Error retrieving ITSP data: ' + res.error)
                        }
                        // Remove disabled class to button
                        $('#retrieveITSPDataBtn').removeClass('btn-loading');
                    }
                });
            }
        });
    }

    // Insert ITSP data to form
    function insertValueToForm(itsp_data){
        $('#changeClass').val(itsp_data['change_class']);
        $('#startWithShutdown').val(itsp_data['start_with_shutdown']);
        $('#pmcStartTime').val(itsp_data['pmc_start_time']);
        $('#pmcEndTime').val(itsp_data['pmc_end_time']);
        if (itsp_data['region'] == 'NA' || itsp_data['region'] == 'LA') {
            $('#region').val('AM');
        } else {
            $('#region').val(itsp_data['region']);
        }
        $('#locationCode').val(itsp_data['location_code']);
        $('#dataCenterRoom').val(itsp_data['dataCenterRoom']);
        $('#peopleOnSite').val(itsp_data['people_onsite']);
        $('#emailAddress').val(itsp_data['email_address']);
        $('#contactInformation').val(itsp_data['contact_information']);
        $('#additionalPeople').val(itsp_data['additional_people']);
        $('#reason').val(itsp_data['reason']);
    }

    // Save PMC activity
    function savePMCActivity(){
        $('#activityPlanSave').on('click', function (){
            if (pmcActivityInputValidate()){
                $('#activityPlanSave').addClass('btn-loading');
                // Add loading bar
                $('#saveLoadingDiv').append('<div id="loadingBar" class="progress progress-sm"><div class="progress-bar progress-bar-indeterminate"></div></div>');
                $.ajax({
                    url: "{% url 'new_request_save_activity_plan' %}",
                    method: 'POST',
                    data: $('#newRequestForm').serialize(),
                    dataType: 'json',
                    success: function (res) {
                        if (res.status) {
                            window.parent.pmcActivitySavedModal(res.data.pmc_id);
                        } else {
                            layer.msg('Error saving PMC avtivity: ' + res.error);
                        }
                        // Remove loading bar
                        $('#loadingBar').remove();
                        $('#activityPlanSave').removeClass('btn-loading');
                    }
                });
            }
        });
    }

    // Validate ITSP request input
    function itspRequestInputValidate() {
        // Clear error msg
        $('#itspNumber').removeAttr('style');
        $('#itspNumber').next().removeAttr('style');
        $('#itspNumber').parent().next().removeAttr('style');
        // Valid if the input is number
        let numberValidate = new RegExp('^[0-9]*$');

        // Validate if the input is empty
        let validateFlag = true;
        if ($('#itspNumber').val() == '' || !numberValidate.test($('#itspNumber').val())) {
            $('#itspNumber').prop('style', 'border-color: var(--tblr-danger)');
            $('#itspNumber').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#itspNumber').parent().next().prop('style','display: inline');
            validateFlag = false;
        }
        return validateFlag;
    }

    // Validate PMC activity input
    function pmcActivityInputValidate(){
        // Clear error msg
        $('#itspNumber,#changeNumber,#emailAddress,#startWithShutdown,#locationCode,#peopleOnSite,#contactInformation,#additionalPeople,#dataCenterRoom').removeAttr('style');
        $('#itspNumber,#changeNumber,#emailAddress,#startWithShutdown,#locationCode,#peopleOnSite,#contactInformation,#additionalPeople,#dataCenterRoom').next().removeAttr('style');
        $('#itspNumber,#changeNumber,#emailAddress,#startWithShutdown,#locationCode,#peopleOnSite,#contactInformation,#additionalPeople,#dataCenterRoom').parent().next().removeAttr('style');
        // Valid if the input is number
        let numberValidate = new RegExp('^[0-9]*$');
        // Validate if the input is number
        let charNumberValidate = new RegExp('^[a-zA-Z0-9 ]*$');
        // Validate if the input is Email address
        let emailValidate = new RegExp('^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$');
        // Validate if the input is location code
        let locationCodeValidate = new RegExp('^[A-Za-z0-9\-]+$');
        // Validate if the input is English name
        let englishNameValidate = new RegExp('^[a-zA-Z ]+$');

        let validateFlag = true;

        if (!numberValidate.test($('#itspNumber').val())) {
            $('#itspNumber').prop('style', 'border-color: var(--tblr-danger)');
            $('#itspNumber').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#itspNumber').parent().next().prop('style','display: inline');
            validateFlag = false;
        }

        if ($('#changeNumber').val() == '' || !charNumberValidate.test($('#changeNumber').val())) {
            $('#changeNumber').prop('style', 'border-color: var(--tblr-danger)');
            $('#changeNumber').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#changeNumber').parent().next().prop('style','display: inline');
            validateFlag = false;
        }

        if ($('#startWithShutdown').val() == '' || !charNumberValidate.test($('#startWithShutdown').val())) {
            $('#startWithShutdown').prop('style', 'border-color: var(--tblr-danger)');
            $('#startWithShutdown').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#startWithShutdown').parent().next().prop('style','display: inline');
            validateFlag = false;
        }

        if ($('#locationCode').val() == '' || !locationCodeValidate.test($('#locationCode').val())) {
            $('#locationCode').prop('style', 'border-color: var(--tblr-danger)');
            $('#locationCode').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#locationCode').parent().next().prop('style','display: inline');
            validateFlag = false;
        }

        // if ($('#peopleOnSite').val() == '' || !englishNameValidate.test($('#peopleOnSite').val())) {
        //     $('#peopleOnSite').prop('style', 'border-color: var(--tblr-danger)');
        //     $('#peopleOnSite').next().prop('style', 'border-color: var(--tblr-danger)');
        //     $('#peopleOnSite').parent().next().prop('style','display: inline');
        //     validateFlag = false;
        // }

        // if ($('#emailAddress').val() == '' || !emailValidate.test($('#emailAddress').val())) {
        //     $('#emailAddress').prop('style', 'border-color: var(--tblr-danger)');
        //     $('#emailAddress').next().prop('style', 'border-color: var(--tblr-danger)');
        //     $('#emailAddress').parent().next().prop('style','display: inline');
        //     validateFlag = false;
        // }

        if ($('#dataCenterRoom').val() == '') {
            $('#dataCenterRoom').prop('style', 'border-color: var(--tblr-danger)');
            $('#dataCenterRoom').next().prop('style', 'border-color: var(--tblr-danger)');
            $('#dataCenterRoom').parent().next().prop('style','display: inline');
            validateFlag = false;
        }

        return validateFlag;
    }

    // Back to parent page
    function pmcViewRequestIndexRedirect(){
        let pageBodyFrame = window.parent.document.getElementById('pageBodyFrame');
        $(pageBodyFrame).attr('src', "{% url 'pmc_view_request_index' %}")
        $(pageBodyFrame).attr('height', '0px');
    }
</script>
</html>